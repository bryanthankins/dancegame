<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.2.2/phaser.min.js"></script>
</head>

<body>

    <script>
       var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('stage', 'assets/pics/stage.jpg');
    game.load.audio('song', ['assets/audio/bodenstaendig_2000_in_rock_4bit.mp3', 'assets/audio/bodenstaendig_2000_in_rock_4bit.ogg']);
    game.load.spritesheet('dancer', 'assets/sprites/dancer.png', 64, 64);
    game.load.image('arrow', 'assets/sprites/arrow.png');
}

var back;
var mummy;
var dancer;
var anim;
var loopText;
var sprite;
var buttonPressed = true;
var timer;
var failCounter = 0;

function create() {
    // Play music
    // music = game.add.audio('song');
    // music.play();

    //Background
    back = game.add.image(0, -100, 'stage');
    back.smoothed = false;

    //dancer
    dancer = game.add.sprite(185, 230, 'dancer', 5);
    dancer.scale.set(3);
    dancer.smoothed = false;
    dancer.animations.add('dance1',game.math.numberArray(0,7));    
    dancer.animations.add('dance2',game.math.numberArray(8,16));
    dancer.animations.add('dance3',game.math.numberArray(17,25));
    dancer.animations.add('dance4',game.math.numberArray(26,34));

    // TODO: Add 4 sprites at diff sprite.angle = 90
    sprite = game.add.sprite(400, 300, 'arrow');
    sprite.anchor.setTo(0.5, 0.5);
    sprite.visible = false;
    sprite.inputEnabled = true;
    sprite.events.onInputDown.add(arrowClick, this);

    // Require them to press the button
    timer = game.time.events.loop(game.rnd.integerInRange(1000, 4000), startNewMove, this);    
}

function resetGame(level) {
    //TODO: reset based on level
}


function startNewMove() {
    //TODO: Show a random arrow
    console.log("Start new move");

    //Show arrow
    sprite.visible = true;

    if(!buttonPressed)
    {
        console.log('fail!');
        failCounter +=1;
        if(failCounter > 2) 
        {
            console.log('game over!');            
            game.time.events.remove(timer);
        }

        buttonPressed = true;
    }
    else
    {
        buttonPressed = false;
    }
    

}

function arrowClick () {

    //hide  arrow
    sprite.visible = false;
    buttonPressed = true;
    console.log('success!');    
    dancer.animations.play('dance' + game.rnd.integerInRange(1, 4),10,true);
}

function update() {

}
    </script>

</body>

</html>