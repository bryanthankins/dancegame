<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.2.2/phaser.min.js"></script>
</head>

<body>

    <script>
       var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('stage', 'assets/pics/stage.png');
    game.load.image('note', 'assets/sprites/musicnote.png');
    game.load.audio('song', ['assets/audio/space.mp3']);
    game.load.spritesheet('dancer', 'assets/sprites/dancer.png', 64, 64);
    game.load.image('arrow', 'assets/sprites/arrow.png');
    game.load.bitmapFont('carrier_command', 'assets/fonts/carrier_command.png', 'assets/fonts/carrier_command.xml');


}

var back;
var mummy;
var dancer;
var anim;
var loopText;
var buttonPressed = true;
var timer;
var failCounter = 0;
var arrows;
var note;
var arrowInterval = 1000;
var currArrow;
var bmpText;
var bmpText2;

function create() {
    // Add music
     music = game.add.audio('song');  
    

 
    // Background
    back = game.add.image(20, -50, 'stage');
    back.smoothed = false;
    back.inputEnabled = true;
    back.events.onInputDown.add(backClick, this);

    // Add Text
    bmpText = game.add.bitmapText(35, 130, 'carrier_command','Social Distance Dancing',20);
    bmpText2 = game.add.bitmapText(205, 175, 'carrier_command','Tap To Start',15);

    // Dancer
    dancer = game.add.sprite(225, 325, 'dancer', 5);
    dancer.scale.set(3);
    dancer.smoothed = false;
    dancer.animations.add('dance1',game.math.numberArray(0,7));    
    dancer.animations.add('dance2',game.math.numberArray(8,16));
    dancer.animations.add('dance3',game.math.numberArray(17,25));
    dancer.animations.add('dance4',game.math.numberArray(26,34));

    // Arrows
    arrows = game.add.group();
    arrows.create(225, 400, 'arrow').angle = 180;
    arrows.create(425, 400, 'arrow').angle = 0;
    arrows.create(320, 290, 'arrow').angle = -90;    
    arrows.forEach(function(arrow){
            arrow.anchor.setTo(0.5, 0.5);
            arrow.visible = true;
            arrow.smoothed = false;
            arrow.inputEnabled = true;
            arrow.events.onInputDown.add(arrowClick, this);
        
    }); 

    // Music note
    note = game.add.sprite(10, 555, 'note');
    note.inputEnabled = true;
    note.events.onInputDown.add(noteClick, this);

   
}

function backClick() {
    
    //music.play();
    dancer.animations.play('dance' + game.rnd.integerInRange(1, 4),10,true);
    back.inputEnabled = false;
    bmpText.visible = false;
    bmpText2.visible = false;
    // Game loop
    timer = game.time.events.loop(arrowInterval, startNewMove, this);    
    
}

function noteClick() {
    music.pause();
}



function startNewMove() {
    console.log("Start new move");
    
    //Show arrow 
    if(currArrow)   
        currArrow.visible = false;
    currArrow = arrows.getRandom();
    currArrow.visible = true;

    if(!buttonPressed)
    {
        console.log('fail!');
        failCounter +=1;
        if(failCounter > 2) 
        {
            console.log('game over!');            
            game.time.events.remove(timer);
        }

        buttonPressed = true;
    }
    else
    {
        buttonPressed = false;
    }
    

}

function arrowClick (arrow) {

    //hide  arrow
    arrow.visible = false;
    buttonPressed = true;
    console.log('success!');    
    dancer.animations.play('dance' + game.rnd.integerInRange(1, 4),10,true);
}

function update() {

}
    </script>

</body>

</html>